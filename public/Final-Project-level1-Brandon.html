<script>
   // global variables here
   let myGlobalX = 0;
   let myClock;
   let myScore = 10;
   let beams = []; // Store active beams

   // global functions here
   function myHitOther(my1, my2) {
      const el1 = document.getElementById(my1);
      const el2 = document.getElementById(my2);
      const rect1 = el1.getBoundingClientRect();
      const rect2 = el2.getBoundingClientRect();
      return (
         rect1.right >= rect2.left &&
         rect1.bottom >= rect2.top &&
         rect1.left <= rect2.right &&
         rect1.top <= rect2.bottom
      );
   }

   function myCheckHit() {
      document.getElementById("myText01").value = myScore; // show the present score

      // Check collisions for each beam
      beams.forEach((beam) => {
         const beamEl = document.getElementById(beam.id);
         if (myHitOther(beam.id, "myImg03")) {
            document.getElementById("myText01").value = "You shot myImg03!";
            beamEl.remove(); // Remove the beam
            myScore += 1;
         }
      });

      if (myHitOther("myImg01", "myImg02")) {
         document.getElementById("myImg01").style.left = "20px";
         document.getElementById("myText01").value = "You hit myImg02";
         myScore -= 1;
      }

      if (myHitOther("myImg01", "myImg03")) {
         document.getElementById("myImg01").style.left = "20px";
         document.getElementById("myText01").value = "You hit myImg03";
         myScore -= 1;
      }

      // You LOSE refresh the page
      if (myScore <= 0) {
         document.getElementById("myText01").value = "You Lose score at zero!";
         alert("Sorry, you lose");
         location.reload();
      }

      // YOU WIN and go to the next level
      if (myHitOther("myImg01", "myImg04")) {
         document.getElementById("myText01").value =
            "You hit myImg04 and you win the game!";
         alert("You Win, now go to the next level");
         document.getElementById("myImg01").style.left = "20px";
         location = "https://www.google.ca";
      }
   }

   function shootBeam(event) {
      // Get the shooting direction
      const player = document.getElementById("myImg01");
      const playerRect = player.getBoundingClientRect();
      const playerCenterX = playerRect.left + playerRect.width / 2;
      const playerCenterY = playerRect.top + playerRect.height / 2;

      const targetX = event.clientX;
      const targetY = event.clientY;

      const angle = Math.atan2(targetY - playerCenterY, targetX - playerCenterX);

      // Create the beam
      const beam = document.createElement("div");
      const beamId = `beam-${Date.now()}`;
      beam.id = beamId;
      beam.style.position = "absolute";
      beam.style.width = "5px";
      beam.style.height = "1000px";
      beam.style.background = "red";
      beam.style.transformOrigin = "top center";
      beam.style.left = playerCenterX + "px";
      beam.style.top = playerCenterY + "px";
      beam.style.transform = `rotate(${angle}rad)`;
      document.body.appendChild(beam);

      // Store the beam
      beams.push({ id: beamId, angle });

      // Move the beam
      const beamSpeed = 20;
      const interval = setInterval(() => {
         const currentLeft = parseFloat(beam.style.left);
         const currentTop = parseFloat(beam.style.top);

         beam.style.left = currentLeft + Math.cos(angle) * beamSpeed + "px";
         beam.style.top = currentTop + Math.sin(angle) * beamSpeed + "px";

         // Remove the beam if it goes off-screen
         if (
            currentLeft < 0 ||
            currentLeft > window.innerWidth ||
            currentTop < 0 ||
            currentTop > window.innerHeight
         ) {
            clearInterval(interval);
            beam.remove();
         }

         myCheckHit();
      }, 20);
   }

   // Event listener for shooting
   document.addEventListener("click", shootBeam);
</script>

<body
   id="myBody"
   style="background-repeat:repeat; background-size: 80%"
   background="myBackground01.jpg"
   onkeydown="
{
   document.getElementById('myText01').value = event.key;

   if (event.key === 'd') { // d = go right
      document.getElementById('myImg01').style.left = parseInt(document.getElementById('myImg01').style.left) + 10 + 'px';
   }
   if (event.key === 'a') { // a = go left
      document.getElementById('myImg01').style.left = parseInt(document.getElementById('myImg01').style.left) - 10 + 'px';
   }
   if (event.key === 's') { // s = go down
      document.getElementById('myImg01').style.top = parseInt(document.getElementById('myImg01').style.top) + 10 + 'px';
   }
   if (event.key === 'w') { // w = go up
      document.getElementById('myImg01').style.top = parseInt(document.getElementById('myImg01').style.top) - 10 + 'px';
   }
   myCheckHit(); // checks for all collisions
}
"
>
   <h1 align="center"><font color="Yellow">T4A06 Bullet by Fred</font></h1>
   <input id="myText01" type="text" value="" size="50" placeholder="Feedback here"><br>

   <!-- Main character's image (myImg01) updated -->
   <img
      id="myImg01"
      src="https://media.licdn.com/dms/image/v2/C5603AQHFrp-bujAh5g/profile-displayphoto-shrink_200_200/profile-displayphoto-shrink_200_200/0/1516969759342?e=2147483647&v=beta&t=bU8c31zVivYN7x39ihu54hkEZt-JwlCTTCWRUrIs3xo"
      style="position:absolute; width:100px; height:100px; left:10px; top:190px;"
   >

   <!-- Other images for interaction -->
   <img id="myImg02" src="myImgNew.jpg" style="position:absolute; width:100px; height:80px; left:350px; top:190px;">
   <img id="myImg03" src="myImgNew.jpg" style="position:absolute; width:100px; height:80px; left:500px; top:190px;">
   <img id="myImg04" src="myImgNew.jpg" style="position:absolute; width:100px; height:80px; left:500px; top:400px;">
</body>
